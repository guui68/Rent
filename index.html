<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>স্মার্ট ভাড়ার রশিদ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #0f172a; --accent: #2563eb; --border-deep: #334155; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 15px; }
        
        .receipt-card { 
            width: 100%; max-width: 420px; background: #fff; padding: 30px; 
            border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            position: relative; border: 1px solid #e2e8f0;
        }

        .header { text-align: center; margin-bottom: 25px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .header h1 { margin: 0; font-size: 24px; color: var(--primary); }

        .info-section { margin-bottom: 20px; }
        .info-row { display: flex; border-bottom: 1px solid #cbd5e1; padding: 8px 0; }
        .info-row label { width: 100px; font-weight: bold; color: #475569; font-size: 14px; }
        input { border: none; outline: none; width: 100%; font-size: 15px; background: transparent; font-family: inherit; }

        /* টেবিল এবং গাঢ় বর্ডার */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 12px 10px; color: var(--primary); border-bottom: 2px solid var(--border-deep); font-size: 14px; }
        .item-row td { padding: 12px 10px; border-bottom: 1.5px solid var(--border-deep); } /* বর্ডার আরও গাঢ় করা হয়েছে */
        
        .amt-input { text-align: right; font-weight: bold; width: 100px; }

        /* পপআপ */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; }
        .modal-box { background: #fff; padding: 25px; border-radius: 15px; width: 300px; }
        .modal-box input { border: 1px solid #94a3b8; padding: 10px; border-radius: 8px; margin: 8px 0; width: 93%; }

        .total-box { 
            margin-top: 25px; padding: 18px; background: var(--primary); 
            border-radius: 12px; color: #fff; display: flex; justify-content: space-between; align-items: center;
        }
        .total-box h2 { margin: 0; font-size: 22px; }

        .actions { width: 100%; max-width: 420px; margin-top: 20px; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-dl { background: #334155; color: white; }
        .btn-sh { background: #16a34a; color: white; }
        .hide-row { display: none !important; }
    </style>
</head>
<body>

<div class="receipt-card" id="capture">
    <div class="header">
        <h1>ভাড়ার রশিদ</h1>
        <small style="font-weight: bold; color: #64748b;">অফিশিয়াল পেমেন্ট কপি</small>
    </div>

    <div class="info-section">
        <div class="info-row"><label>তারিখঃ</label> <input type="text" placeholder="১১/০২/২০২৬"></div>
        <div class="info-row"><label>বাড়িয়ালাঃ</label> <input type="text" placeholder="নাম লিখুন"></div>
        <div class="info-row"><label>ভাড়াটিয়াঃ</label> <input type="text" placeholder="নাম লিখুন"></div>
    </div>

    <table>
        <thead>
            <tr><th>বিবরণ</th><th style="text-align: right;">টাকা (৳)</th></tr>
        </thead>
        <tbody>
            <tr class="item-row"><td>মাসিক ভাড়া</td><td><input type="number" class="fee" value="0" onfocus="clearZero(this)" onblur="setZero(this)" oninput="calc()"></td></tr>
            <tr class="item-row">
                <td>বিদ্যুৎ বিল <small onclick="openPop()" style="color: var(--accent); cursor: pointer; display: block; font-size: 10px;">(হিসাব করুন)</small></td>
                <td><input type="number" id="ebill" class="fee" value="0" onfocus="clearZero(this)" onblur="setZero(this)" oninput="calc()"></td>
            </tr>
            <tr class="item-row"><td>WIFI বিল</td><td><input type="number" class="fee" value="0" onfocus="clearZero(this)" onblur="setZero(this)" oninput="calc()"></td></tr>
            <tr class="item-row"><td>বকেয়া ভাড়া</td><td><input type="number" class="fee" value="0" onfocus="clearZero(this)" onblur="setZero(this)" oninput="calc()"></td></tr>
            <tr class="item-row"><td>হাওলাত</td><td><input type="number" class="fee" value="0" onfocus="clearZero(this)" onblur="setZero(this)" oninput="calc()"></td></tr>
            <tr class="item-row"><td>অন্যান্য</td><td><input type="number" class="fee" value="0" onfocus="clearZero(this)" onblur="setZero(this)" oninput="calc()"></td></tr>
            <tr class="item-row" style="color: #dc2626;"><td>(-) জমা</td><td><input type="number" id="joma" class="minus" value="0" onfocus="clearZero(this)" onblur="setZero(this)" oninput="calc()" style="color: #dc2626;"></td></tr>
        </tbody>
    </table>

    <div class="total-box">
        <span style="font-size: 14px; opacity: 0.8;">মোট প্রদেয় টাকা</span>
        <h2 id="grand">0 ৳</h2>
    </div>
</div>

<div class="modal" id="pop">
    <div class="modal-box">
        <h3 style="margin-top:0;">ইউনিট হিসাব</h3>
        <input type="number" id="c" placeholder="বর্তমান রিডিং" oninput="mCalc()">
        <input type="number" id="p" placeholder="পূর্বের রিডিং" oninput="mCalc()">
        <input type="number" id="r" value="10" placeholder="ইউনিট রেট" oninput="mCalc()">
        <p>বিল: <strong id="mTotal">0</strong> ৳</p>
        <button onclick="savePop()" style="width:100%; padding:10px; background:var(--primary); color:white; border:none; border-radius:8px;">সেভ করুন</button>
        <p onclick="closePop()" style="text-align:center; color:red; cursor:pointer; margin-top:10px;">বন্ধ করুন</p>
    </div>
</div>

<div class="actions">
    <button class="btn btn-dl" onclick="exp('dl')">ডাউনলোড</button>
    <button class="btn btn-sh" onclick="exp('sh')">শেয়ার করুন</button>
</div>

<script>
    // ০ মুছার স্মার্ট ফাংশন
    function clearZero(el) { if(el.value == "0") el.value = ""; }
    function setZero(el) { if(el.value == "") el.value = "0"; }

    function openPop() { document.getElementById('pop').style.display = 'flex'; }
    function closePop() { document.getElementById('pop').style.display = 'none'; }
    function mCalc() {
        let res = ((parseFloat(document.getElementById('c').value) || 0) - (parseFloat(document.getElementById('p').value) || 0)) * (parseFloat(document.getElementById('r').value) || 0);
        document.getElementById('mTotal').innerText = res > 0 ? res : 0;
    }
    function savePop() {
        document.getElementById('ebill').value = document.getElementById('mTotal').innerText;
        closePop(); calc();
    }
    function calc() {
        let t = 0; document.querySelectorAll('.fee').forEach(f => t += parseFloat(f.value) || 0);
        let j = parseFloat(document.getElementById('joma').value) || 0;
        document.getElementById('grand').innerText = (t - j) + " ৳";
    }
    function exp(m) {
        const box = document.getElementById('capture');
        const rows = document.querySelectorAll('.item-row');
        rows.forEach(r => {
            let v = r.querySelector('input').value;
            // শুধু সেভ করার সময় ০ ভ্যালু ওয়ালা রো হাইড হবে
            if (v == "0" || v == "") r.classList.add('hide-row');
            else { 
                r.classList.remove('hide-row');
                r.querySelector('input').setAttribute('value', v); 
            }
        });

        html2canvas(box, { scale: 3, backgroundColor: "#f8fafc" }).then(cvs => {
            rows.forEach(r => r.classList.remove('hide-row'));
            if (m === 'dl') {
                const a = document.createElement('a'); a.download = 'Receipt.png'; a.href = cvs.toDataURL(); a.click();
            } else {
                cvs.toBlob(b => {
                    const f = new File([b], "R.png", {type:"image/png"});
                    if (navigator.share) navigator.share({files:[f]});
                });
            }
        });
    }
</script>

</body>
</html>
