<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ভাড়ার রশিদ - অফিসিয়াল</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --main: #1a2a6c; --text: #333; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* মেইন কন্টেইনার */
        .receipt-container { 
            width: 100%; max-width: 450px; background: #fff; padding: 0; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative;
            border-bottom: 2px solid #000;
        }

        /* উপরের নীল স্ট্রাইপ এবং ডান পাশের বক্স */
        .top-stripe { background: var(--main); height: 35px; width: 100%; }
        .side-box { position: absolute; right: 30px; top: 35px; background: var(--main); width: 45px; height: 140px; }

        .header-section { text-align: center; padding-top: 40px; margin-bottom: 30px; }
        .header-section h1 { margin: 0; font-size: 40px; color: var(--main); font-weight: 800; }
        .sub-header { color: #888; font-size: 16px; border-bottom: 1px solid #eee; display: inline-block; padding-bottom: 5px; margin-top: 5px; }

        .content-area { padding: 0 30px 30px 30px; }

        /* তথ্য বক্স */
        .info-row { display: flex; margin-bottom: 15px; border-bottom: 2px solid #888; padding-bottom: 5px; align-items: center; }
        .info-row label { font-weight: 900; width: 100px; font-size: 18px; color: #000; }
        .info-row input { border: none; outline: none; width: 100%; font-size: 18px; color: #444; background: transparent; }

        .add-btn { background: #f8f9fa; color: var(--main); border: 1.5px dashed var(--main); padding: 8px; width: 100%; margin: 15px 0; cursor: pointer; font-weight: bold; }

        /* টেবিল ডিজাইন */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: var(--main); color: #fff; padding: 15px; text-align: left; font-size: 18px; }
        td { padding: 12px 15px; border-bottom: 1px solid #eee; position: relative; }
        
        .amt-col { text-align: right; font-weight: bold; width: 120px; font-size: 18px; }
        .reading-text { font-size: 11px; color: #0047ab; font-weight: bold; position: absolute; left: 15px; bottom: 2px; pointer-events: none; }
        #calc-link { color: #0047ab; cursor: pointer; font-size: 11px; font-weight: bold; display: block; margin-top: 2px; }

        .del-btn { position: absolute; left: -25px; top: 50%; transform: translateY(-50%); color: red; border: none; background: none; cursor: pointer; font-weight: bold; }

        /* মোট পাওনা বক্স */
        .total-section { 
            margin-top: 30px; display: flex; align-items: center; 
            background: #f9f9f9; border-left: 10px solid var(--main); padding: 25px 15px;
            justify-content: space-between;
        }
        .total-label { font-size: 20px; font-weight: 900; color: #000; }
        .total-amount { font-size: 35px; font-weight: 900; color: var(--main); }

        .in-word { padding: 10px 30px; font-size: 16px; font-weight: bold; color: #333; }

        /* মডাল */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 1000; }
        .modal-card { background: #fff; padding: 25px; border-radius: 10px; width: 300px; border-top: 8px solid var(--main); }
        .modal-card input, .modal-card select { border: 1px solid #ddd; padding: 10px; border-radius: 5px; margin: 10px 0; width: 92%; font-size: 16px; }

        .btn-group { width: 100%; max-width: 450px; margin-top: 20px; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 5px; font-weight: bold; color: #fff; cursor: pointer; }
        .btn-save { background: var(--main); color: #fff; padding: 12px; width: 100%; border: none; margin-top: 10px; border-radius: 5px; cursor: pointer; }

        .hide-for-capture { display: none !important; }
        .editable-label { width: 100%; border: none; outline: none; background: transparent; cursor: pointer; font-weight: inherit; font-size: inherit; }
    </style>
</head>
<body>

<div class="receipt-container" id="receipt">
    <div class="top-stripe"></div>
    <div class="side-box"></div>

    <div class="header-section">
        <h1>ভাড়ার রশিদ</h1>
        <div class="sub-header">অফিসিয়াল পেমেন্ট মেমো</div>
    </div>

    <div class="content-area">
        <div class="info-box">
            <div class="info-row"><label>তারিখঃ</label> <input type="text" id="date-input" placeholder="১৫/০২/২০২৬" ondblclick="setToday()"></div>
            <div class="info-row"><label>বাড়িয়ালাঃ</label> <input type="text" placeholder="নাম লিখুন"></div>
            <div class="info-row"><label>রুম নংঃ</label> <input type="text" id="room-input" placeholder="১০২"></div>
            <div class="info-row"><label>ভাড়াটিয়াঃ</label> <input type="text" id="tenant-input" placeholder="নাম লিখুন"></div>
        </div>

        <button class="add-btn capture-hide" onclick="addNewRow()">+ নতুন আইটেম যোগ করুন</button>

        <table>
            <thead>
                <tr>
                    <th width="60%">বিবরণ</th>
                    <th class="amt-col">টাকা (৳)</th>
                </tr>
            </thead>
            <tbody id="items-table">
                <tr class="item-row"><td>মাসিক ভাড়া</td><td class="amt-col"><input type="number" class="fee" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="calc()" value="0" style="text-align: right;"></td></tr>
                <tr class="item-row">
                    <td>বিদ্যুৎ বিল <small id="calc-link" class="capture-hide" onclick="openElecModal()">(ক্যালকুলেটর)</small></td>
                    <td class="amt-col">
                        <input type="number" id="elec-val" class="fee" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="checkType()" value="0" style="text-align: right; width: 100%;">
                        <div id="ebill-info" class="reading-text"></div>
                    </td>
                </tr>
                <tr class="item-row"><td>Wifi বিল</td><td class="amt-col"><input type="number" class="fee" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="calc()" value="0" style="text-align: right;"></td></tr>
                <tr class="item-row"><td>ময়লার বিল</td><td class="amt-col"><input type="number" class="fee" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="calc()" value="0" style="text-align: right;"></td></tr>
                <tr class="item-row"><td>আগের বকেয়া</td><td class="amt-col"><input type="number" class="fee" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="calc()" value="0" style="text-align: right;"></td></tr>
                <tr class="item-row"><td>হাওলাত</td><td class="amt-col"><input type="number" class="fee" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="calc()" value="0" style="text-align: right;"></td></tr>
            </tbody>
            <tfoot>
                <tr class="item-row" style="background: #fff;">
                    <td style="color: #d32f2f; font-weight: bold;">(-) জমা</td>
                    <td class="amt-col"><input type="number" id="joma" class="minus" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="calc()" value="0" style="text-align: right; color: #d32f2f;"></td>
                </tr>
            </tfoot>
        </table>

        <div class="total-section">
            <div class="total-label">মোট পাওনাঃ</div>
            <div class="total-amount" id="total-text">0 ৳</div>
        </div>
    </div>
    <div class="in-word" id="in-word-text">কথায়: শূন্য টাকা মাত্র</div>
</div>

<div class="modal" id="modal-elec">
    <div class="modal-card">
        <h3 style="text-align:center; color:var(--main);">বিদ্যুৎ বিল হিসাব</h3>
        <label>বর্তমান (V)</label><input type="number" id="curr" placeholder="0" oninput="liveCalc()">
        <label>পূর্বের (P)</label><input type="number" id="prev" placeholder="0" oninput="liveCalc()">
        <label>রেট (৳)</label><input type="number" id="rate" value="10" oninput="liveCalc()">
        <div style="background:#eef2ff; padding:10px; text-align:center; font-weight:bold; border:1px dashed var(--main);">
            U: <span id="u-res">0</span> | বিল: <span id="b-res">0</span> ৳
        </div>
        <button class="btn-save" onclick="saveElec()">সেভ করুন</button>
        <p onclick="closeModal('modal-elec')" style="text-align:center; color:red; cursor:pointer; margin-top:10px; font-weight:bold;">বন্ধ করুন</p>
    </div>
</div>

<div class="btn-group">
    <button class="btn" style="background:#333;" onclick="process('download')">ছবি</button>
    <button class="btn" style="background:#dc3545;" onclick="process('pdf')">পিডিএফ</button>
    <button class="btn" style="background:#25D366;" onclick="process('share')">শেয়ার</button>
</div>

<script>
    let activeInput = null;

    function clearZero(el) { if(el.value == "0") el.value = ""; }
    function resetZero(el) { if(el.value == "") el.value = "0"; }

    function setToday() {
        const t = new Date();
        document.getElementById('date-input').value = `${String(t.getDate()).padStart(2,'0')}/${String(t.getMonth()+1).padStart(2,'0')}/${t.getFullYear()}`;
    }

    function addNewRow() {
        const table = document.getElementById('items-table');
        const row = document.createElement('tr');
        row.className = 'item-row';
        row.innerHTML = `
            <td>
                <button class="del-btn capture-hide" onclick="this.parentElement.parentElement.remove(); calc();">×</button>
                <input type="text" class="editable-label" value="নতুন আইটেম">
            </td>
            <td class="amt-col"><input type="number" class="fee" onfocus="clearZero(this)" onblur="resetZero(this)" oninput="calc()" value="0" style="text-align: right;"></td>
        `;
        table.appendChild(row);
        const inp = row.querySelector('.editable-label');
        inp.focus(); inp.select();
    }

    function openElecModal() { document.getElementById('modal-elec').style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function liveCalc() {
        let c = parseFloat(document.getElementById('curr').value) || 0;
        let p = parseFloat(document.getElementById('prev').value) || 0;
        let r = parseFloat(document.getElementById('rate').value) || 0;
        let u = c - p;
        document.getElementById('u-res').innerText = u > 0 ? u : 0;
        document.getElementById('b-res').innerText = u > 0 ? (u * r) : 0;
    }

    function saveElec() {
        document.getElementById('elec-val').value = document.getElementById('b-res').innerText;
        document.getElementById('ebill-info').innerText = `V=${document.getElementById('curr').value || 0} P=${document.getElementById('prev').value || 0} U=${document.getElementById('u-res').innerText}`;
        closeModal('modal-elec'); calc();
    }

    function checkType() { document.getElementById('ebill-info').innerText = ""; calc(); }

    function calc() {
        let total = 0;
        document.querySelectorAll('.fee').forEach(f => total += parseFloat(f.value) || 0);
        let grand = total - (parseFloat(document.getElementById('joma').value) || 0);
        document.getElementById('total-text').innerText = grand + " ৳";
        document.getElementById('in-word-text').innerText = "কথায়: " + bnAmount(grand) + " টাকা মাত্র";
    }

    function bnAmount(n) {
        if (n <= 0) return "শূন্য";
        const units = ['', 'এক', 'দুই', 'তিন', 'চার', 'পাঁচ', 'ছয়', 'সাত', 'আট', 'নয়'];
        const teens = ['দশ', 'এগারো', 'বারো', 'তেরো', 'চৌদ্দ', 'পনেরো', 'ষোলো', 'সতেরো', 'আঠারো', 'উনিশ'];
        const tens = ['', '', 'বিশ', 'ত্রিশ', 'চল্লিশ', 'পঞ্চাশ', 'ষাট', 'সত্তর', 'আশি', 'নব্বই'];
        function conv(num) {
            if (num < 10) return units[num];
            if (num < 20) return teens[num-10];
            if (num < 100) return tens[Math.floor(num/10)] + (num%10!==0?" "+units[num%10]:"");
            if (num < 1000) return units[Math.floor(num/100)] + " শত " + (num%100!==0?conv(num%100):"");
            if (num < 100000) return conv(Math.floor(num/1000)) + " হাজার " + (num%1000!==0?conv(num%1000):"");
            return conv(Math.floor(num/100000)) + " লক্ষ " + (num%100000!==0?conv(num%100000):"");
        }
        return conv(Math.floor(n));
    }

    async function process(mode) {
        const tenant = document.getElementById('tenant-input').value || "ভাড়াটিয়া";
        const room = document.getElementById('room-input').value || "রুম";
        const fileName = `${tenant}_${room}`;

        document.querySelectorAll('.capture-hide, .del-btn, .add-btn').forEach(el => el.classList.add('hide-for-capture'));
        document.querySelectorAll('.item-row').forEach(row => { 
            let val = parseFloat(row.querySelector('input[type="number"]')?.value) || 0;
            if(val === 0 && !row.innerHTML.includes('joma')) row.classList.add('hide-for-capture'); 
        });

        const canvas = await html2canvas(document.getElementById('receipt'), { scale: 3, backgroundColor: "#ffffff" });
        document.querySelectorAll('.hide-for-capture').forEach(el => el.classList.remove('hide-for-capture'));

        if (mode === 'pdf') {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 10, 10, 190, (canvas.height * 190) / canvas.width);
            pdf.save(fileName + ".pdf");
        } else if (mode === 'download') {
            const link = document.createElement('a');
            link.download = fileName + ".png";
            link.href = canvas.toDataURL();
            link.click();
        } else if (mode === 'share') {
            canvas.toBlob(b => navigator.share({files:[new File([b], fileName + ".png", {type:"image/png"})]}));
        }
    }
</script>
</body>
</html>
