<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রিমিয়াম ভাড়ার রশিদ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --main: #1a2a6c; --text: #333; --border-color: #000; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #e9ecef; display: flex; flex-direction: column; align-items: center; padding: 15px; }
        
        .receipt-container { 
            width: 100%; max-width: 450px; background: #fff; padding: 30px; 
            border-radius: 5px; box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border-top: 15px solid var(--main); position: relative;
        }

        .receipt-container::after {
            content: ""; position: absolute; top: 0; right: 20px;
            width: 40px; height: 60px; background: var(--main); clip-path: polygon(0 0, 100% 0, 100% 100%, 50% 85%, 0 100%);
        }

        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 28px; color: var(--main); letter-spacing: 2px; }
        .header p { margin: 5px 0; color: #777; font-size: 14px; border-bottom: 1px solid #eee; display: inline-block; padding-bottom: 5px; }

        .info-box { margin-bottom: 15px; font-size: 15px; }
        .info-box div { display: flex; margin-bottom: 8px; border-bottom: 2px solid #555; padding-bottom: 3px; position: relative; }
        .info-box label { font-weight: bold; width: 110px; color: #000; }
        input { border: none; outline: none; width: 100%; font-family: inherit; font-size: 15px; color: var(--text); background: transparent; }

        .add-btn {
            background: #f1f3f5; color: var(--main); border: 1px dashed var(--main);
            padding: 8px; width: 100%; margin-bottom: 15px; cursor: pointer;
            font-weight: bold; border-radius: 4px; transition: 0.3s;
        }

        table { width: 100%; border-collapse: collapse; border: 2px solid var(--main); }
        th { background: var(--main); color: #fff; padding: 12px; font-size: 15px; text-align: left; }
        td { padding: 12px; border-bottom: 1.5px solid var(--border-color); font-size: 15px; color: #000; position: relative; }
        
        .amt-col { text-align: right; font-weight: bold; width: 130px; }
        
        .reading-text { 
            font-size: 12px; color: #0047ab; font-weight: 800; 
            position: absolute; left: 12px; bottom: 6px; pointer-events: none;
        }

        .del-btn {
            position: absolute; left: -25px; top: 50%; transform: translateY(-50%);
            color: red; border: none; background: none; cursor: pointer; font-weight: bold; font-size: 18px;
        }

        .total-box { 
            margin-top: 20px; padding: 20px 20px 10px 20px; background: #f8f9fa; border-left: 8px solid var(--main);
            border-bottom: 2px solid #000; display: block;
        }
        .total-flex { display: flex; justify-content: space-between; align-items: center; }
        .total-box h2 { margin: 0; font-size: 24px; color: var(--main); }
        .in-word-box { font-size: 12px; color: #555; margin-top: 5px; font-style: italic; font-weight: bold; }

        .btn-group { width: 100%; max-width: 450px; margin-top: 20px; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 5px; font-weight: bold; color: #fff; cursor: pointer; transition: 0.3s; }
        .btn-dl { background: #333; }
        .btn-sh { background: #25D366; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 1000; }
        .modal-card { background: #fff; padding: 25px; border-radius: 10px; width: 300px; }
        .modal-card input { border: 1px solid #000; padding: 10px; border-radius: 5px; margin: 8px 0; width: 93%; background: #fff; }
        .btn-save { background: var(--main); color: #fff; border: none; padding: 12px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; }

        .hide-for-capture { display: none !important; }
        .editable-label { width: 100%; border: none; outline: none; background: transparent; }
    </style>
</head>
<body>

<div class="receipt-container" id="receipt">
    <div class="header">
        <h1>ভাড়ার রশিদ</h1>
        <p>অফিশিয়াল পেমেন্ট মেমো</p>
    </div>

    <div class="info-box">
        <div><label>তারিখঃ</label> <input type="text" id="date-input" placeholder="ডাবল ক্লিক করুন" ondblclick="setToday()"></div>
        <div><label>বাড়িয়ালাঃ</label> <input type="text" placeholder="নাম লিখুন"></div>
        <div><label>রুম নংঃ</label> <input type="text" id="room-input" placeholder="১০২"></div>
        <div><label>ভাড়াটিয়াঃ</label> <input type="text" id="tenant-input" placeholder="নাম লিখুন"></div>
    </div>

    <button class="add-btn capture-hide" id="add-item-btn" onclick="addNewRow()">+ নতুন আইটেম যোগ করুন</button>

    <table>
        <thead>
            <tr>
                <th>বিবরণ</th>
                <th style="text-align: right;">টাকা (৳)</th>
            </tr>
        </thead>
        <tbody id="items-table">
            <tr class="item-row"><td>মাসিক ভাড়া</td><td class="amt-col"><input type="number" class="fee" oninput="calc()" value="0" style="text-align: right;"></td></tr>
            <tr class="item-row">
                <td>বিদ্যুৎ বিল <small class="capture-hide" style="color:blue; cursor:pointer;" onclick="openModal()">(ক্যালকুলেটর)</small></td>
                <td class="amt-col">
                    <input type="number" id="elec-val" class="fee" oninput="checkType()" value="0" style="text-align: right; width: 100%;">
                    <div id="ebill-info" class="reading-text"></div>
                </td>
            </tr>
            <tr class="item-row"><td>WIFI বিল</td><td class="amt-col"><input type="number" class="fee" oninput="calc()" value="0" style="text-align: right;"></td></tr>
        </tbody>
        <tfoot>
            <tr class="item-row" style="background: #fff5f5;">
                <td style="color: #d32f2f; font-weight: bold;">(-) জমা</td>
                <td class="amt-col"><input type="number" id="joma" class="minus" oninput="calc()" value="0" style="text-align: right; color: #d32f2f;"></td>
            </tr>
        </tfoot>
    </table>

    <div class="total-box">
        <div class="total-flex">
            <span>মোট পাওনাঃ</span>
            <h2 id="total-text">0 ৳</h2>
        </div>
        <div class="in-word-box" id="in-word-text">কথায়: শূন্য টাকা মাত্র</div>
    </div>
</div>

<div class="modal" id="modal">
    <div class="modal-card">
        <h3 style="text-align: center;">ইউনিট হিসাব</h3>
        <label>বর্তমান (V)</label><input type="number" id="curr" oninput="modalCalc()">
        <label>পূর্বের (P)</label><input type="number" id="prev" oninput="modalCalc()">
        <label>রেট (৳)</label><input type="number" id="rate" value="10" oninput="modalCalc()">
        <button class="btn-save" onclick="save()">সেভ করুন</button>
        <p onclick="closeModal()" style="text-align:center; color:red; cursor:pointer; margin-top:10px;">বন্ধ করুন</p>
    </div>
</div>

<div class="btn-group">
    <button class="btn btn-dl" onclick="process('download')">ডাউনলোড</button>
    <button class="btn btn-sh" onclick="process('share')">শেয়ার করুন</button>
</div>

<script>
    function setToday() {
        const today = new Date();
        const d = String(today.getDate()).padStart(2, '0');
        const m = String(today.getMonth() + 1).padStart(2, '0');
        const y = today.getFullYear();
        document.getElementById('date-input').value = `${d}/${m}/${y}`;
    }

    function addNewRow() {
        const table = document.getElementById('items-table');
        const row = document.createElement('tr');
        row.className = 'item-row';
        row.innerHTML = `
            <td>
                <button class="del-btn capture-hide" onclick="this.parentElement.parentElement.remove(); calc();">×</button>
                <input type="text" class="editable-label" placeholder="নাম লিখুন">
            </td>
            <td class="amt-col"><input type="number" class="fee" oninput="calc()" value="0" style="text-align: right;"></td>
        `;
        table.appendChild(row);
    }

    function calc() {
        let total = 0; 
        document.querySelectorAll('.fee').forEach(f => total += parseFloat(f.value) || 0);
        let joma = parseFloat(document.getElementById('joma').value) || 0;
        let grandTotal = total - joma;
        document.getElementById('total-text').innerText = grandTotal + " ৳";
        document.getElementById('in-word-text').innerText = "কথায়: " + bnAmount(grandTotal) + " টাকা মাত্র";
    }

    function bnAmount(n) {
        if (n == 0) return "শূন্য";
        const units = ['', 'এক', 'দুই', 'তিন', 'চার', 'পাঁচ', 'ছয়', 'সাত', 'আট', 'নয়'];
        const teens = ['দশ', 'এগারো', 'বারো', 'তেরো', 'চৌদ্দ', 'পনেরো', 'ষোলো', 'সতেরো', 'আঠারো', 'উনিশ'];
        const tens = ['', '', 'বিশ', 'ত্রিশ', 'চল্লিশ', 'পঞ্চাশ', 'ষাট', 'সত্তর', 'আশি', 'নব্বই'];
        
        function convert(num) {
            if (num < 10) return units[num];
            if (num < 20) return teens[num - 10];
            if (num < 100) return tens[Math.floor(num / 10)] + (num % 10 !== 0 ? " " + units[num % 10] : "");
            if (num < 1000) return units[Math.floor(num / 100)] + " শত " + (num % 100 !== 0 ? convert(num % 100) : "");
            if (num < 100000) return convert(Math.floor(num / 1000)) + " হাজার " + (num % 1000 !== 0 ? convert(num % 1000) : "");
            if (num < 10000000) return convert(Math.floor(num / 100000)) + " লক্ষ " + (num % 100000 !== 0 ? convert(num % 100000) : "");
            return convert(Math.floor(num / 10000000)) + " কোটি " + (num % 10000000 !== 0 ? convert(num % 10000000) : "");
        }
        return convert(n);
    }

    function openModal() { document.getElementById('modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function modalCalc() {
        let c = parseFloat(document.getElementById('curr').value) || 0;
        let p = parseFloat(document.getElementById('prev').value) || 0;
        let r = parseFloat(document.getElementById('rate').value) || 0;
        let unit = c - p;
        return { unit: unit > 0 ? unit : 0, bill: unit > 0 ? (unit * r) : 0 };
    }
    function save() {
        let res = modalCalc();
        document.getElementById('elec-val').value = res.bill;
        document.getElementById('ebill-info').innerText = "V=" + document.getElementById('curr').value + " P=" + document.getElementById('prev').value + " U=" + res.unit;
        closeModal(); calc();
    }
    function checkType() { document.getElementById('ebill-info').innerText = ""; calc(); }

    async function process(mode) {
        const area = document.getElementById('receipt');
        const rows = document.querySelectorAll('.item-row');
        const tenantName = document.getElementById('tenant-input').value || "ভাড়াটিয়া";
        const roomNo = document.getElementById('room-input').value || "রুম";
        const fileName = tenantName + "_" + roomNo + ".png";

        document.querySelectorAll('.capture-hide, .del-btn, #add-item-btn').forEach(el => el.classList.add('hide-for-capture'));
        rows.forEach(row => {
            let input = row.querySelector('input[type="number"]');
            if(input && (parseFloat(input.value) === 0 || input.value === "")) row.classList.add('hide-for-capture');
        });

        const canvas = await html2canvas(area, { scale: 3, useCORS: true, backgroundColor: "#ffffff" });
        document.querySelectorAll('.hide-for-capture').forEach(el => el.classList.remove('hide-for-capture'));

        if (mode === 'download') {
            const link = document.createElement('a');
            link.download = fileName;
            link.href = canvas.toDataURL("image/png");
            link.click();
        } else {
            canvas.toBlob(blob => {
                const file = new File([blob], fileName, { type: "image/png" });
                if (navigator.share) navigator.share({ files: [file] });
            });
        }
    }
</script>
</body>
</html>
